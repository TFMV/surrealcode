# SurrealCode: Go Code Analysis Tool

SurrealCode is a static code analysis tool designed to extract, analyze, and visualize Go code structure. It integrates with **SurrealDB** for storage and querying of code relationships.

## 📐 Architecture

```ascii
+----------------+      +------------------+      +------------------+
|                |      |                  |      |                  |
|  Go Source     | ───> |  Code Parser     | ───> |  Data Models &   |
|  Files         |      |  & Analyzer      |      |  Storage         |
|                |      |                  |      |                  |
+----------------+      +------------------+      +------------------+
       |                         |
       v                         v
+------------------+      +------------------+
|                  |      |                  |
|  Visualization   |      |  SurrealDB        |
|  (DOT/D3.js)    |      |  Graph Database   |
|                  |      |                  |
+------------------+      +------------------+
```

## 📦 Installation

1. Clone the repository:

```bash
git clone https://github.com/TFMV/surrealcode.git
```

2. Install dependencies:

```bash
go mod tidy
```

3. Start SurrealDB:

Please note that you will need to have [SurrealDB](https://github.com/surrealdb/surrealdb?tab=readme-ov-file#getting-started) installed and running on your machine.

```bash
surreal start --user root --pass root --bind 0.0.0.0:8000 memory
```

4. Run the application:

```bash
go run cmd/main.go analyze ./surrealcode/demo
```

## 📊 Metrics

### Code Metrics

- **Function Count**: Total number of functions in the codebase.
- **Struct Count**: Total number of structs in the codebase.
- **Interface Count**: Total number of interfaces in the codebase.
- **Global Variables**: Total number of global variables in the codebase.
- **Import Count**: Total number of imports in the codebase.

### Code Quality Metrics

- **Code Duplication**: Total number of duplicate lines of code in the codebase.
- **Code Complexity**: Total number of complexity metrics in the codebase.
- **Code Maintainability**: Total number of maintainability metrics in the codebase.

### Code Complexity Metrics

- **Cyclomatic Complexity**: Total number of cyclomatic complexity metrics in the codebase.
- **Halstead Metrics**: Total number of halstead metrics in the codebase.
- **Maintainability Index**: Total number of maintainability index metrics in the codebase.

## Summary Report

The summary report is a JSON file that contains the results of the code analysis. It is generated by the `analyze` command.

```json
{
  "total_functions": 65,
  "total_structs": 27,
  "total_imports": 76,
  "functions": [
    {
      "name": "ComputeReadabilityMetrics",
      "file": "analysis/analyzer.go",
      "complexity": 10,
      "lines": 75,
      "maintainability": 79.6,
      "nesting_depth": 2,
      "is_unused": false
    },
    {
      "name": "CountLines",
      "file": "analysis/analyzer.go",
      "complexity": 2,
      "lines": 9,
      "maintainability": 97.60000000000001,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "TestAnalyzer_ParseGoFile",
      "file": "analysis/analyzer_test.go",
      "complexity": 3,
      "lines": 88,
      "maintainability": 81.2,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "NewSurrealDB",
      "file": "db/surreal.go",
      "complexity": 2,
      "lines": 11,
      "maintainability": 97.2,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "TestAnalyzer_GetAnalysis",
      "file": "analysis/analyzer_test.go",
      "complexity": 1,
      "lines": 16,
      "maintainability": 96.8,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "TestHalsteadMetricsComplexFunction",
      "file": "analysis/metrics_test.go",
      "complexity": 1,
      "lines": 20,
      "maintainability": 96,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "TestDuplicationWithComments",
      "file": "analysis/metrics_test.go",
      "complexity": 1,
      "lines": 21,
      "maintainability": 95.8,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "PrettyPrint",
      "file": "types/models.go",
      "complexity": 3,
      "lines": 44,
      "maintainability": 90,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "GenerateCodeSummary",
      "file": "analysis/analyzer.go",
      "complexity": 8,
      "lines": 65,
      "maintainability": 82.8,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "StoreAnalysis",
      "file": "db/surreal.go",
      "complexity": 11,
      "lines": 38,
      "maintainability": 86.4,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "findFunction",
      "file": "analysis/analyzer.go",
      "complexity": 3,
      "lines": 8,
      "maintainability": 97.2,
      "nesting_depth": 1,
      "is_unused": true
    },
    {
      "name": "Multiply",
      "file": "demo/example.go",
      "complexity": 1,
      "lines": 3,
      "maintainability": 99.4,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "AnalyzeFunction",
      "file": "analysis/analyzer.go",
      "complexity": 1,
      "lines": 8,
      "maintainability": 98.4,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "NewAnalyzer",
      "file": "analysis/analyzer.go",
      "complexity": 2,
      "lines": 14,
      "maintainability": 96.60000000000001,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "ComputeHalsteadMetrics",
      "file": "analysis/metrics.go",
      "complexity": 1,
      "lines": 42,
      "maintainability": 91.6,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "NewMockDB",
      "file": "db/mock.go",
      "complexity": 1,
      "lines": 7,
      "maintainability": 98.6,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "Initialize",
      "file": "db/surreal.go",
      "complexity": 4,
      "lines": 20,
      "maintainability": 94.2,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "isHotspot",
      "file": "analysis/analyzer.go",
      "complexity": 1,
      "lines": 5,
      "maintainability": 99,
      "nesting_depth": 0,
      "is_unused": true
    },
    {
      "name": "identifyIssues",
      "file": "analysis/analyzer.go",
      "complexity": 6,
      "lines": 21,
      "maintainability": 92.8,
      "nesting_depth": 1,
      "is_unused": true
    },
    {
      "name": "DetectDuplication",
      "file": "analysis/analyzer.go",
      "complexity": 2,
      "lines": 17,
      "maintainability": 96,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "Visit",
      "file": "analysis/analyzer.go",
      "complexity": 4,
      "lines": 44,
      "maintainability": 89.4,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "ComputeCognitiveComplexity",
      "file": "analysis/analyzer.go",
      "complexity": 7,
      "lines": 73,
      "maintainability": 81.80000000000001,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "DetectDeadCode",
      "file": "analysis/analyzer.go",
      "complexity": 6,
      "lines": 25,
      "maintainability": 92,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "TestMaintainabilityIndex",
      "file": "analysis/metrics_test.go",
      "complexity": 1,
      "lines": 15,
      "maintainability": 97,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "TestCountLines",
      "file": "analysis/metrics_test.go",
      "complexity": 1,
      "lines": 14,
      "maintainability": 97.2,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "DotProduct",
      "file": "demo/example.go",
      "complexity": 2,
      "lines": 7,
      "maintainability": 98,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "NewCodeDuplicationDetector",
      "file": "analysis/metrics.go",
      "complexity": 1,
      "lines": 5,
      "maintainability": 99,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "TestComputeCognitiveComplexity",
      "file": "analysis/metrics_test.go",
      "complexity": 2,
      "lines": 56,
      "maintainability": 88.2,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "NewParser",
      "file": "parser/parser.go",
      "complexity": 1,
      "lines": 5,
      "maintainability": 99,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "ParseFile",
      "file": "parser/parser.go",
      "complexity": 18,
      "lines": 107,
      "maintainability": 69.8,
      "nesting_depth": 3,
      "is_unused": false
    },
    {
      "name": "TestComputeHalsteadMetrics",
      "file": "analysis/metrics_test.go",
      "complexity": 1,
      "lines": 15,
      "maintainability": 97,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "TestComputeReadabilityMetrics",
      "file": "analysis/metrics_test.go",
      "complexity": 1,
      "lines": 16,
      "maintainability": 96.8,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "Put",
      "file": "expr/cache.go",
      "complexity": 1,
      "lines": 5,
      "maintainability": 99,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "extractFunctionBody",
      "file": "analysis/metrics.go",
      "complexity": 1,
      "lines": 23,
      "maintainability": 95.4,
      "nesting_depth": 0,
      "is_unused": true
    },
    {
      "name": "TestDetectDuplication",
      "file": "analysis/metrics_test.go",
      "complexity": 1,
      "lines": 22,
      "maintainability": 95.6,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "DetectRecursion",
      "file": "analysis/recursion.go",
      "complexity": 14,
      "lines": 67,
      "maintainability": 78.8,
      "nesting_depth": 3,
      "is_unused": false
    },
    {
      "name": "min",
      "file": "analysis/recursion.go",
      "complexity": 2,
      "lines": 6,
      "maintainability": 98.2,
      "nesting_depth": 1,
      "is_unused": true
    },
    {
      "name": "ExecuteOperations",
      "file": "demo/example.go",
      "complexity": 1,
      "lines": 11,
      "maintainability": 97.8,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "Clear",
      "file": "expr/cache.go",
      "complexity": 1,
      "lines": 3,
      "maintainability": 99.4,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "markReachable",
      "file": "analysis/analyzer.go",
      "complexity": 5,
      "lines": 15,
      "maintainability": 94.6,
      "nesting_depth": 2,
      "is_unused": true
    },
    {
      "name": "TestAnalyzerMetrics",
      "file": "analysis/analyzer_test.go",
      "complexity": 1,
      "lines": 55,
      "maintainability": 89,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "NewMetricsAnalyzer",
      "file": "analysis/analyzer.go",
      "complexity": 1,
      "lines": 5,
      "maintainability": 99,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "AnalyzeDirectory",
      "file": "analysis/analyzer.go",
      "complexity": 3,
      "lines": 15,
      "maintainability": 95.8,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "TestDetectRecursion",
      "file": "analysis/analyzer_test.go",
      "complexity": 3,
      "lines": 56,
      "maintainability": 87.6,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "TestAnalyzer_Initialize",
      "file": "analysis/analyzer_test.go",
      "complexity": 1,
      "lines": 9,
      "maintainability": 98.2,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "TestDetectDeadCode",
      "file": "analysis/metrics_test.go",
      "complexity": 2,
      "lines": 50,
      "maintainability": 89.4,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "InitializeSchema",
      "file": "schema/schema.go",
      "complexity": 2,
      "lines": 7,
      "maintainability": 98,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "NewAnalyzerWithoutDB",
      "file": "analysis/analyzer.go",
      "complexity": 1,
      "lines": 8,
      "maintainability": 98.4,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "computeMetrics",
      "file": "analysis/analyzer.go",
      "complexity": 1,
      "lines": 42,
      "maintainability": 91.6,
      "nesting_depth": 0,
      "is_unused": true
    },
    {
      "name": "rabinKarpHash",
      "file": "analysis/metrics.go",
      "complexity": 2,
      "lines": 8,
      "maintainability": 97.80000000000001,
      "nesting_depth": 0,
      "is_unused": true
    },
    {
      "name": "SquareRoot",
      "file": "demo/example.go",
      "complexity": 1,
      "lines": 3,
      "maintainability": 99.4,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "NewExprCache",
      "file": "expr/cache.go",
      "complexity": 1,
      "lines": 5,
      "maintainability": 99,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "ToString",
      "file": "expr/cache.go",
      "complexity": 9,
      "lines": 70,
      "maintainability": 81.2,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "simpleTypeString",
      "file": "parser/parser.go",
      "complexity": 1,
      "lines": 14,
      "maintainability": 97.2,
      "nesting_depth": 0,
      "is_unused": true
    },
    {
      "name": "TestReadabilityWithNestedBlocks",
      "file": "analysis/metrics_test.go",
      "complexity": 1,
      "lines": 19,
      "maintainability": 96.2,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "main",
      "file": "demo/example.go",
      "complexity": 1,
      "lines": 4,
      "maintainability": 99.2,
      "nesting_depth": 0,
      "is_unused": false
    },
    {
      "name": "Get",
      "file": "expr/cache.go",
      "complexity": 2,
      "lines": 8,
      "maintainability": 97.80000000000001,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "computeLOC",
      "file": "parser/utils.go",
      "complexity": 2,
      "lines": 6,
      "maintainability": 98.2,
      "nesting_depth": 1,
      "is_unused": true
    },
    {
      "name": "GetAnalysis",
      "file": "analysis/analyzer.go",
      "complexity": 8,
      "lines": 61,
      "maintainability": 83.6,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "MaintainabilityIndex",
      "file": "analysis/analyzer.go",
      "complexity": 4,
      "lines": 29,
      "maintainability": 92.4,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "computeComplexity",
      "file": "parser/utils.go",
      "complexity": 2,
      "lines": 16,
      "maintainability": 96.2,
      "nesting_depth": 1,
      "is_unused": true
    },
    {
      "name": "children",
      "file": "analysis/analyzer.go",
      "complexity": 2,
      "lines": 11,
      "maintainability": 97.2,
      "nesting_depth": 1,
      "is_unused": true
    },
    {
      "name": "isExported",
      "file": "analysis/analyzer.go",
      "complexity": 2,
      "lines": 6,
      "maintainability": 98.2,
      "nesting_depth": 1,
      "is_unused": true
    },
    {
      "name": "BenchmarkDetectRecursion",
      "file": "analysis/analyzer_test.go",
      "complexity": 2,
      "lines": 13,
      "maintainability": 96.80000000000001,
      "nesting_depth": 1,
      "is_unused": false
    },
    {
      "name": "Add",
      "file": "demo/example.go",
      "complexity": 1,
      "lines": 3,
      "maintainability": 99.4,
      "nesting_depth": 0,
      "is_unused": false
    }
  ]
}
```
